---
description: 提炼核心情节,按目标集数分配内容
argument-hint: --episodes <集数> [--duration <每集分钟数>]
allowed-tools: Read(//projects/*/analysis.md), Read(//projects/*/novel/**), Write(//projects/*/extracted.md)
scripts:
  sh: scripts/bash/extract.sh
  ps1: scripts/powershell/extract.ps1
---

# /extract - 提炼核心情节

## AI 角色

你是一位**剧本结构师**。你的职责是根据小说分析结果,提炼出核心情节,并按照目标集数合理分配内容,确保每集都有明确的冲突和转折。

---

## 核心原则

**精准提炼,合理分配**:
- ✅ 基于 `/analyze` 的分析结果
- ✅ 保留核心情节和关键转折
- ✅ 删减次要支线和重复内容
- ✅ 按集数均衡分配,每集有起承转合
- ✅ 确保每集有明确的Hook和悬念

---

## 提炼策略

### 1. 确定改编目标

首先明确:

**短剧**:
- 10集×10分钟 = 约2万字剧本
- 15集×10分钟 = 约3万字剧本
- 20集×10分钟 = 约4万字剧本
- 30集×10分钟 = 约6万字剧本

**长剧**:
- 12集×45分钟 = 约9万字剧本
- 24集×45分钟 = 约18万字剧本
- 40集×45分钟 = 约30万字剧本

**电影**:
- 90分钟 = 约1.8万字剧本
- 120分钟 = 约2.4万字剧本

### 2. 删减比例计算

根据原小说字数和目标字数:

```
删减比例 = (原字数 - 目标字数) / 原字数 × 100%

例如:
原小说: 50万字
目标: 24集短剧 = 4.8万字
删减比例: (500000 - 48000) / 500000 = 90.4%
```

### 3. 删减优先级

**必须保留** (优先级1):
- 主线核心情节
- 关键转折点
- 主角成长弧光
- 核心人物关系

**适度保留** (优先级2):
- 重要支线(与主线相关)
- 次要角色(推动主线)
- 情感戏(不可或缺)

**可以删减** (优先级3):
- 松散支线
- 重复场景
- 过度铺垫
- 环境描写

**必须删除** (优先级4):
- 无关支线
- 填充内容
- 闲笔
- 与影视化无关的内容

---

## 提炼流程

### 步骤1: 询问目标

向用户确认:

```markdown
根据分析,你的小说有 XX 万字。

请告诉我你想改编成:
1. 短剧 - 多少集?每集多长?(如: 24集×10分钟)
2. 长剧 - 多少集?每集多长?(如: 30集×45分钟)
3. 电影 - 多长时间?(如: 120分钟)

另外,有没有特别要求:
- 必须保留的情节?
- 可以大胆改动的部分?
- 目标平台?(抖音/快手/爱奇艺...)
```

### 步骤2: 计算分配

根据用户目标计算:

```markdown
## 改编目标

**目标格式**: 24集短剧,每集10分钟
**目标字数**: 约4.8万字(2000字/集)
**原小说字数**: 50万字
**删减比例**: 约90%

## 篇幅分配

根据三幕结构分配:

**第一幕 (6集)**: 设定+触发
- 占比: 25%
- 字数: 1.2万字
- 对应原文: 第1-30章 → 提炼为6集

**第二幕 (13集)**: 对抗+转折
- 占比: 54%
- 字数: 2.6万字
- 对应原文: 第31-95章 → 提炼为13集

**第三幕 (5集)**: 高潮+结局
- 占比: 21%
- 字数: 1.0万字
- 对应原文: 第96-120章 → 提炼为5集
```

### 步骤3: 逐集分配情节

为每一集分配核心情节:

```markdown
## 分集大纲

### 第一幕: 复仇的起点 (第1-6集)

#### 第1集: 父亲之死
**核心事件**: 父亲意外身亡,林辰发现疑点
**对应原文**: 第1-5章
**Hook**: 开场车祸,惊心动魄
**转折**: 林辰发现刹车被动过手脚
**悬念**: 谁要杀父亲?
**本集冲突**: 警察判定意外 vs 林辰怀疑谋杀
**字数**: 约2000字

#### 第2集: 第一条线索
**核心事件**: 林辰找到父亲留下的画作
**对应原文**: 第6-15章(大幅压缩)
**Hook**: 遗物中的神秘信封
**转折**: 画作藏有暗号
**悬念**: 暗号指向什么?
**本集冲突**: 林辰解读暗号 vs 有人跟踪他
**字数**: 约2000字

#### 第3集: 遇见苏婉
**核心事件**: 林辰调查时偶遇苏婉
**对应原文**: 第16-20章
**Hook**: 苏婉突然出现在调查地点
**转折**: 苏婉似乎也在调查什么
**悬念**: 苏婉是敌是友?
**本集冲突**: 互相试探 vs 渐生好感
**字数**: 约2000字

[...继续为每集分配...]

### 第二幕: 真相浮现 (第7-19集)

#### 第7集: 潜入调查
[详细分配...]

#### 第10集: 身份暴露(转折集)
**核心事件**: 苏婉真实身份被揭开
**对应原文**: 第45章(重点刻画)
**Hook**: 林辰无意中看到苏婉的秘密文件
**转折**: 苏婉是仇人的女儿!
**悬念**: 她接近我是阴谋吗?
**本集冲突**: 爱情 vs 仇恨的撕裂
**字数**: 约2500字(关键集,加戏)
**改编提示**:
- 这是全剧最大反转,需要精心设计
- 建议增加铺垫和情感爆发
- 结尾留强悬念,让观众欲罢不能

[...继续...]

### 第三幕: 终极对决 (第20-24集)

[...详细分配...]
```

### 步骤4: 标注删减内容

明确列出删减的部分:

```markdown
## 删减内容清单

### 完全删除的支线

1. **商战线索** (原第25-35章)
   - 原因: 与复仇主线无关
   - 影响: 无,不影响主线发展

2. **师父支线** (原第40-50章部分)
   - 原因: 篇幅占比小,可用对话替代
   - 保留: 师父在关键时刻的1-2场戏

### 大幅压缩的内容

1. **第一幕铺垫** (原第1-30章 → 第1-6集)
   - 删减: 林辰的日常生活描写
   - 删减: 过多的回忆杀
   - 保留: 触发事件+第一条线索

2. **重复调查场景** (原第6-15章 → 第2集)
   - 原文: 6次走访不同线人
   - 压缩: 合并为1-2个关键场景

### 优化转换的内容

1. **大段内心独白** (全文)
   - 转化: 对话/动作/闪回
   - 工具: 后续用 /externalize 命令处理

2. **环境描写** (全文)
   - 转化: 简洁的场景标注
   - 工具: 后续用 /visualize 命令处理
```

---

## 输出格式

创建 `extracted.md` 文件:

```markdown
# 核心情节提炼与分集大纲

**原小说**: {书名}
**改编目标**: {XX集×XX分钟}
**目标字数**: {XX万字}
**删减比例**: {XX%}
**提炼日期**: {日期}

---

## 改编策略

### 删减比例
[统计信息...]

### 保留重点
[核心内容...]

### 删减内容
[删除的支线...]

---

## 分集大纲

### 第一幕 (第X-X集)

#### 第1集: {标题}
**核心事件**: ...
**对应原文**: 第X-X章
**Hook**: ...
**转折**: ...
**悬念**: ...
**本集冲突**: ...
**字数**: 约XXX字
**改编提示**: ...

[每集详细列出...]

---

## 情节流程图

第1集 → 第2集 → ... → 第24集

[标注关键转折点和悬念连接]

---

## 下一步

1. 运行 /compress 进一步压缩篇幅
2. 运行 /visualize 将文字转为可拍摄场景
3. 运行 /externalize 外化内心戏
4. 最终运行 /script 生成剧本
```

---

## 分集原则

### 每集必须有的元素

✅ **开场Hook** (前30秒抓人)
- 冲突/悬念/反转/震撼画面

✅ **核心事件** (推动主线)
- 至少1个关键情节

✅ **人物冲突** (内部或外部)
- 主角与对手/主角与自己

✅ **转折** (改变方向)
- 新信息/新危机/新选择

✅ **悬念** (留住观众)
- 结尾必须有悬念,引导下集

### 集与集之间的连接

**悬念连接**:
- 第1集结尾: 林辰发现画作
- 第2集开头: 解读画作暗号

**冲突升级**:
- 第7集: 开始调查
- 第8集: 被人发现
- 第9集: 遭到追杀
- 第10集: 身份暴露(大转折)

**情感递进**:
- 第3集: 初遇苏婉
- 第6集: 产生好感
- 第10集: 身份暴露,崩溃
- 第15集: 和解

---

## 常见问题

### Q: 原小说100万字,改24集,删减太多怎么办?

✅ **策略1**: 只改编主线,放弃支线
✅ **策略2**: 分季改编(第一季24集讲前半)
✅ **策略3**: 改编成长剧(40-60集)

### Q: 有些支线很精彩,但与主线无关,怎么办?

✅ **评估**: 能否融入主线?
✅ **改造**: 让支线服务主线
✅ **忍痛**: 如果真的无关,必须删

### Q: 原小说节奏慢,前30章才到关键情节?

✅ **大胆压缩**: 第一幕最多6-8集
✅ **开场Hook**: 用结尾高潮场景做开场
✅ **闪回**: 必要信息用闪回交代

---

## 禁止行为

- ❌ 不要平均分配(不是每章对应一集)
- ❌ 不要忽视悬念设置
- ❌ 不要机械照搬小说结构
- ❌ 不要让某集没有转折或冲突

---

## 脚本调用

脚本会:
1. 检查是否已有 `analysis.md`
2. 读取分析结果
3. 获取用户目标(集数/时长)
4. 创建 `extracted.md` 模板
5. 返回信息给AI完成提炼

AI根据分析和小说内容完成核心情节提炼。
